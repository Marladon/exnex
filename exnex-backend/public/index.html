<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>exnex</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { margin-bottom: 30px; color: #333; }
        .section { margin-bottom: 40px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        input, textarea, select { 
            width: 100%; padding: 10px; margin: 10px 0; 
            border: 1px solid #ccc; border-radius: 4px; 
        }
        button { 
            padding: 10px 20px; background: #007bff; 
            color: white; border: none; border-radius: 4px; 
            cursor: pointer; 
        }
        button:hover { background: #0056b3; }
        .ads-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .ad-card { border: 1px solid #ddd; padding: 15px; border-radius: 8px; }
        .ad-price { color: #28a745; font-weight: bold; font-size: 1.2em; }
        .error { color: red; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Exnex - –î–æ—Å–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</h1>
        
        <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
        <div class="section">
            <h2>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <input type="email" id="regEmail" placeholder="Email">
            <input type="password" id="regPassword" placeholder="–ü–∞—Ä–æ–ª—å">
            <input type="text" id="regName" placeholder="–ò–º—è">
            <button onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <div id="regResult" class="error"></div>
        </div>

        <!-- –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
        <div class="section">
            <h2>‚ûï –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h2>
            <input type="number" id="adUserId" placeholder="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)">
            <select id="adCategory">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é...</option>
            </select>
            <input type="text" id="adTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
            <textarea id="adDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" rows="3"></textarea>
            <input type="number" id="adPrice" placeholder="–¶–µ–Ω–∞">
            <input type="text" id="adLocation" placeholder="–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ">
            <button onclick="createAd()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
            <div id="adResult" class="error"></div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π -->
        <div class="section">
            <h2>üìã –í—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h2>
            <button onclick="loadAds()">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
            <div id="adsContainer" class="ads-grid"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';
        let categories = [];

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        async function loadCategories() {
            try {
                const res = await fetch(`${API_URL}/categories`);
                const data = await res.json();
                categories = data.categories;
                const select = document.getElementById('adCategory');
                select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é...</option>' +
                    categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('');
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', err);
            }
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        async function register() {
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const name = document.getElementById('regName').value;
            const resultDiv = document.getElementById('regResult');
            
            try {
                const res = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, name })
                });
                const data = await res.json();
                if (res.ok) {
                    resultDiv.style.color = 'green';
                    resultDiv.textContent = `–£—Å–ø–µ—à–Ω–æ! ID: ${data.user.id}`;
                    document.getElementById('adUserId').value = data.user.id;
                } else {
                    resultDiv.textContent = `–û—à–∏–±–∫–∞: ${data.error}`;
                }
            } catch (err) {
                resultDiv.textContent = `–û—à–∏–±–∫–∞: ${err.message}`;
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
        async function createAd() {
            const ad = {
                user_id: document.getElementById('adUserId').value,
                category_id: document.getElementById('adCategory').value,
                title: document.getElementById('adTitle').value,
                description: document.getElementById('adDescription').value,
                price: document.getElementById('adPrice').value,
                location: document.getElementById('adLocation').value
            };
            const resultDiv = document.getElementById('adResult');
            
            try {
                const res = await fetch(`${API_URL}/ads`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(ad)
                });
                const data = await res.json();
                if (res.ok) {
                    resultDiv.style.color = 'green';
                    resultDiv.textContent = `–û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ! ID: ${data.ad.id}`;
                    loadAds();
                } else {
                    resultDiv.textContent = `–û—à–∏–±–∫–∞: ${data.error}`;
                }
            } catch (err) {
                resultDiv.textContent = `–û—à–∏–±–∫–∞: ${err.message}`;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
        async function loadAds() {
            try {
                const res = await fetch(`${API_URL}/ads`);
                const data = await res.json();
                const container = document.getElementById('adsContainer');
                container.innerHTML = data.ads.map(ad => `
                    <div class="ad-card">
                        <h3>${ad.title}</h3>
                        <p>${ad.description}</p>
                        <div class="ad-price">${ad.price ? ad.price + ' ‚ÇΩ' : '–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è'}</div>
                        <p><small>üìç ${ad.location || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</small></p>
                        <p><small>üë§ ${ad.user_name || '–ê–Ω–æ–Ω–∏–º'}</small></p>
                        <p><small>üìÅ ${ad.category_name || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'}</small></p>
                        <p><small>üëÅÔ∏è ${ad.views} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</small></p>
                    </div>
                `).join('');
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π:', err);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            loadCategories();
            loadAds();
        });
    </script>
</body>
</html>